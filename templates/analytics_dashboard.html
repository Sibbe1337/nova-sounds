{% extends "base.html" %}

{% block title %}Analytics Dashboard{% endblock %}

{% block styles %}
<link rel="stylesheet" href="/static/css/analytics.css">
{% endblock %}

{% block content %}
<div class="analytics-dashboard">
    <div class="dashboard-header">
        <h1>Analytics Dashboard</h1>
        <div class="dashboard-controls">
            <div class="date-range-picker">
                <select id="date-range">
                    <option value="7">Last 7 days</option>
                    <option value="30" selected>Last 30 days</option>
                    <option value="90">Last 90 days</option>
                    <option value="custom">Custom range</option>
                </select>
                <div class="comparison-toggle">
                    <input type="checkbox" id="enable-comparison" class="toggle-checkbox">
                    <label for="enable-comparison" class="toggle-label">Compare</label>
                </div>
                <div id="custom-date-range" class="hidden">
                    <input type="date" id="date-from" placeholder="From">
                    <input type="date" id="date-to" placeholder="To">
                    <button id="apply-date-range" class="btn primary">Apply</button>
                </div>
            </div>
            <div class="export-controls">
                <div class="export-dropdown">
                    <button id="export-button" class="export-btn">
                        <svg width="16" height="16" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
                            <path d="M12 16L12 8M12 16L8 12M12 16L16 12" stroke="currentColor" stroke-width="2" stroke-linecap="round"/>
                            <path d="M3 15V16C3 18.2091 4.79086 20 7 20H17C19.2091 20 21 18.2091 21 16V15" stroke="currentColor" stroke-width="2" stroke-linecap="round"/>
                        </svg>
                        Export
                    </button>
                    <div class="export-menu hidden">
                        <button id="export-csv" class="export-option">
                            <svg width="16" height="16" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
                                <path d="M14 3v4a1 1 0 0 0 1 1h4" stroke="currentColor" stroke-width="2"/>
                                <path d="M17 21H7a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h7l5 5v11a2 2 0 0 1-2 2z" stroke="currentColor" stroke-width="2"/>
                                <path d="M10 12v6M14 12v6M8 18h8" stroke="currentColor" stroke-width="2" stroke-linecap="round"/>
                            </svg>
                            CSV
                        </button>
                        <button id="export-pdf" class="export-option">
                            <svg width="16" height="16" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
                                <path d="M14 3v4a1 1 0 0 0 1 1h4" stroke="currentColor" stroke-width="2"/>
                                <path d="M17 21H7a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h7l5 5v11a2 2 0 0 1-2 2z" stroke="currentColor" stroke-width="2"/>
                                <path d="M9.5 12h1.5M9.5 16h1.5M13 12h1.5M13 16h1.5" stroke="currentColor" stroke-width="2" stroke-linecap="round"/>
                            </svg>
                            PDF
                        </button>
                        <button id="export-image" class="export-option">
                            <svg width="16" height="16" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
                                <rect x="3" y="3" width="18" height="18" rx="2" stroke="currentColor" stroke-width="2"/>
                                <circle cx="8.5" cy="8.5" r="1.5" fill="currentColor"/>
                                <path d="M21 15l-5-5L5 21" stroke="currentColor" stroke-width="2"/>
                            </svg>
                            Image
                        </button>
                    </div>
                </div>
            </div>
        </div>
    </div>
    
    <!-- Comparison period indicator (initially hidden) -->
    <div id="comparison-info" class="comparison-info hidden">
        <div class="current-period">
            <div class="period-indicator primary"></div>
            <span>Current: <span id="current-period-label">Last 30 days</span></span>
        </div>
        <div class="previous-period">
            <div class="period-indicator secondary"></div>
            <span>Previous: <span id="previous-period-label">Previous 30 days</span></span>
        </div>
    </div>
    
    <!-- Overall stats cards -->
    <div class="stats-cards">
        <div class="stat-card">
            <h3>Total Views</h3>
            <div class="stat-value" id="total-views">
                <span class="skeleton large"></span>
            </div>
            <div class="trend-indicator" id="views-trend">
                <span class="skeleton small"></span>
            </div>
        </div>
        <div class="stat-card">
            <h3>Engagement Rate</h3>
            <div class="stat-value" id="engagement-rate">
                <span class="skeleton large"></span>
            </div>
            <div class="trend-indicator" id="engagement-trend">
                <span class="skeleton small"></span>
            </div>
        </div>
        <div class="stat-card">
            <h3>Avg. Watch Time</h3>
            <div class="stat-value" id="avg-watch-time">
                <span class="skeleton large"></span>
            </div>
            <div class="trend-indicator" id="watch-time-trend">
                <span class="skeleton small"></span>
            </div>
        </div>
        <div class="stat-card">
            <h3>Total Subscribers</h3>
            <div class="stat-value" id="subscribers">
                <span class="skeleton large"></span>
            </div>
            <div class="trend-indicator" id="subscribers-trend">
                <span class="skeleton small"></span>
            </div>
        </div>
    </div>
    
    <!-- Platform comparison chart -->
    <div class="chart-container">
        <h2>Platform Performance</h2>
        <div class="chart-controls">
            <select id="chart-metric">
                <option value="views" selected>Views</option>
                <option value="engagement">Engagement</option>
                <option value="watch_time">Watch Time</option>
                <option value="growth">Growth</option>
            </select>
        </div>
        <div id="platform-chart-container">
            <canvas id="platform-chart"></canvas>
            <div id="platform-chart-loading" class="skeleton-chart"></div>
        </div>
    </div>
    
    <div class="dashboard-grid">
        <!-- Left column -->
        <div class="dashboard-column">
            <!-- Top performing content -->
            <div class="table-container">
                <h2>Top Performing Content</h2>
                <div class="table-controls">
                    <select id="top-content-sort">
                        <option value="views" selected>Views</option>
                        <option value="engagement">Engagement</option>
                        <option value="ctr">Click-through Rate</option>
                        <option value="watch_time">Watch Time</option>
                    </select>
                    <select id="top-content-platform">
                        <option value="">All platforms</option>
                        <option value="youtube">YouTube</option>
                        <option value="tiktok">TikTok</option>
                        <option value="instagram">Instagram</option>
                        <option value="facebook">Facebook</option>
                    </select>
                </div>
                <table id="top-content-table">
                    <thead>
                        <tr>
                            <th>Video</th>
                            <th>Platform</th>
                            <th>Views</th>
                            <th>Engagement</th>
                            <th>CTR</th>
                            <th>Avg Watch</th>
                            <th>Actions</th>
                        </tr>
                    </thead>
                    <tbody id="top-content-table-body">
                        <!-- Skeleton Loading -->
                        <tr class="skeleton-loading">
                            <td colspan="7">
                                <div class="skeleton-table-row">
                                    <div class="skeleton-table-cell">
                                        <div class="skeleton-image"></div>
                                        <div class="skeleton medium" style="width: 70%;"></div>
                                    </div>
                                    <div class="skeleton-table-cell">
                                        <div class="skeleton small" style="width: 70%;"></div>
                                    </div>
                                    <div class="skeleton-table-cell">
                                        <div class="skeleton small" style="width: 60%;"></div>
                                    </div>
                                    <div class="skeleton-table-cell">
                                        <div class="skeleton small" style="width: 50%;"></div>
                                    </div>
                                    <div class="skeleton-table-cell">
                                        <div class="skeleton small" style="width: 40%;"></div>
                                    </div>
                                    <div class="skeleton-table-cell">
                                        <div class="skeleton small" style="width: 50%;"></div>
                                    </div>
                                    <div class="skeleton-table-cell">
                                        <div class="skeleton small" style="width: 80%;"></div>
                                    </div>
                                </div>
                            </td>
                        </tr>
                        <tr class="skeleton-loading">
                            <td colspan="7">
                                <div class="skeleton-table-row">
                                    <div class="skeleton-table-cell">
                                        <div class="skeleton-image"></div>
                                        <div class="skeleton medium" style="width: 80%;"></div>
                                    </div>
                                    <div class="skeleton-table-cell">
                                        <div class="skeleton small" style="width: 70%;"></div>
                                    </div>
                                    <div class="skeleton-table-cell">
                                        <div class="skeleton small" style="width: 60%;"></div>
                                    </div>
                                    <div class="skeleton-table-cell">
                                        <div class="skeleton small" style="width: 50%;"></div>
                                    </div>
                                    <div class="skeleton-table-cell">
                                        <div class="skeleton small" style="width: 40%;"></div>
                                    </div>
                                    <div class="skeleton-table-cell">
                                        <div class="skeleton small" style="width: 50%;"></div>
                                    </div>
                                    <div class="skeleton-table-cell">
                                        <div class="skeleton small" style="width: 80%;"></div>
                                    </div>
                                </div>
                            </td>
                        </tr>
                        <tr class="skeleton-loading">
                            <td colspan="7">
                                <div class="skeleton-table-row">
                                    <div class="skeleton-table-cell">
                                        <div class="skeleton-image"></div>
                                        <div class="skeleton medium" style="width: 60%;"></div>
                                    </div>
                                    <div class="skeleton-table-cell">
                                        <div class="skeleton small" style="width: 70%;"></div>
                                    </div>
                                    <div class="skeleton-table-cell">
                                        <div class="skeleton small" style="width: 60%;"></div>
                                    </div>
                                    <div class="skeleton-table-cell">
                                        <div class="skeleton small" style="width: 50%;"></div>
                                    </div>
                                    <div class="skeleton-table-cell">
                                        <div class="skeleton small" style="width: 40%;"></div>
                                    </div>
                                    <div class="skeleton-table-cell">
                                        <div class="skeleton small" style="width: 50%;"></div>
                                    </div>
                                    <div class="skeleton-table-cell">
                                        <div class="skeleton small" style="width: 80%;"></div>
                                    </div>
                                </div>
                            </td>
                        </tr>
                    </tbody>
                </table>
            </div>
        
            <!-- Historical trends chart -->
            <div class="chart-container">
                <h2>Historical Performance</h2>
                <div class="chart-controls">
                    <select id="historical-metric">
                        <option value="views" selected>Views</option>
                        <option value="engagement">Engagement</option>
                        <option value="watch_time">Watch Time</option>
                    </select>
                </div>
                <div id="historical-chart-container">
                    <canvas id="historical-chart"></canvas>
                    <div id="historical-chart-loading" class="skeleton-chart"></div>
                </div>
            </div>
        </div>
        
        <!-- Right column -->
        <div class="dashboard-column">
            <!-- Engagement heatmap -->
            <div class="chart-container">
                <h2>Engagement Heatmap</h2>
                <div class="video-selector">
                    <select id="heatmap-video-selector">
                        <option value="">Select a video</option>
                    </select>
                    <select id="heatmap-platform-selector">
                        <option value="">All platforms</option>
                        <option value="youtube">YouTube</option>
                        <option value="tiktok">TikTok</option>
                        <option value="instagram">Instagram</option>
                        <option value="facebook">Facebook</option>
                    </select>
                </div>
                <div id="heatmap-container">
                    <!-- Skeleton loading for heatmap -->
                    <div class="skeleton-heatmap">
                        <div class="skeleton-row" style="height: 160px; align-items: flex-end;">
                            <div class="skeleton" style="height: 30px; margin: 0 1px; flex: 1;"></div>
                            <div class="skeleton" style="height: 45px; margin: 0 1px; flex: 1;"></div>
                            <div class="skeleton" style="height: 65px; margin: 0 1px; flex: 1;"></div>
                            <div class="skeleton" style="height: 80px; margin: 0 1px; flex: 1;"></div>
                            <div class="skeleton" style="height: 95px; margin: 0 1px; flex: 1;"></div>
                            <div class="skeleton" style="height: 110px; margin: 0 1px; flex: 1;"></div>
                            <div class="skeleton" style="height: 90px; margin: 0 1px; flex: 1;"></div>
                            <div class="skeleton" style="height: 75px; margin: 0 1px; flex: 1;"></div>
                            <div class="skeleton" style="height: 60px; margin: 0 1px; flex: 1;"></div>
                            <div class="skeleton" style="height: 40px; margin: 0 1px; flex: 1;"></div>
                            <div class="skeleton" style="height: 55px; margin: 0 1px; flex: 1;"></div>
                            <div class="skeleton" style="height: 70px; margin: 0 1px; flex: 1;"></div>
                            <div class="skeleton" style="height: 85px; margin: 0 1px; flex: 1;"></div>
                            <div class="skeleton" style="height: 100px; margin: 0 1px; flex: 1;"></div>
                            <div class="skeleton" style="height: 105px; margin: 0 1px; flex: 1;"></div>
                            <div class="skeleton" style="height: 85px; margin: 0 1px; flex: 1;"></div>
                            <div class="skeleton" style="height: 70px; margin: 0 1px; flex: 1;"></div>
                            <div class="skeleton" style="height: 55px; margin: 0 1px; flex: 1;"></div>
                            <div class="skeleton" style="height: 40px; margin: 0 1px; flex: 1;"></div>
                            <div class="skeleton" style="height: 35px; margin: 0 1px; flex: 1;"></div>
                        </div>
                        <div class="skeleton-row" style="margin-top: 10px;">
                            <div class="skeleton small" style="width: 10%;"></div>
                            <div class="skeleton small" style="width: 10%; margin-left: auto;"></div>
                        </div>
                    </div>
                </div>
            </div>
    
            <!-- Content recommendations based on analytics -->
            <div class="recommendations-container">
                <h2>Content Recommendations</h2>
                <div id="recommendations-list">
                    <!-- Skeleton loading for recommendations -->
                    <div class="skeleton-loading">
                        <div class="skeleton-card">
                            <div class="skeleton medium" style="width: 70%;"></div>
                            <div class="skeleton small" style="width: 90%;"></div>
                            <div class="skeleton small" style="width: 80%;"></div>
                        </div>
                        <div class="skeleton-card">
                            <div class="skeleton medium" style="width: 60%;"></div>
                            <div class="skeleton small" style="width: 95%;"></div>
                            <div class="skeleton small" style="width: 85%;"></div>
                        </div>
                        <div class="skeleton-card">
                            <div class="skeleton medium" style="width: 65%;"></div>
                            <div class="skeleton small" style="width: 85%;"></div>
                            <div class="skeleton small" style="width: 75%;"></div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>

{% endblock %}

{% block scripts %}
<script src="https://cdn.jsdelivr.net/npm/chart.js@3.9.1/dist/chart.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/moment@2.29.4/moment.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/html2canvas@1.4.1/dist/html2canvas.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/jspdf@2.5.1/dist/jspdf.umd.min.js"></script>
<script src="/static/js/analytics-dashboard.js"></script>
{% endblock %} 